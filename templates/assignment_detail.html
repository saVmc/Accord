{% extends "layout.html" %}
{% block content %}
<div class="page">
  <div class="card">
    <h2>{{ assignment[2] }}</h2>
    <div class="muted">Due: {{ assignment[4] }}</div>
    <div style="margin:1rem 0;">{{ assignment[3] }}</div>
    <div class="muted">Class: <a href="{{ url_for('class_detail', class_id=class_row[0]) }}">{{ class_row[1] }}</a></div>
  </div>
  {% if user and user.role == "student" %}
    <div class="card">
      <h3>Submit Assignment</h3>
      {% if my_submission %}
        <p class="muted">You already submitted: <a href="{{ my_submission[3] }}">View File</a> ({{ my_submission[4] }})</p>
        {% if my_submission[5] %}
          <p class="muted">Grade: <strong>{{ my_submission[6] or "Ungraded" }}</strong></p>
          <p>Feedback: {{ my_submission[7] or "-" }}</p>
        {% endif %}
      {% else %}
        <form method="POST" action="{{ url_for('submit_assignment', assignment_id=assignment[0]) }}" enctype="multipart/form-data">
          <input type="file" name="file" required />
          <button class="btn" type="submit">Submit</button>
        </form>
      {% endif %}
    </div>
  {% endif %}
  {% if user and user.role == "teacher" %}
    <div class="card">
      <h3>Submissions ({{ submissions|length }})</h3>
      {% if submissions %}
        <ul>
          {% for s in submissions %}
            <li style="margin-bottom:1.3em;">
              <img class="avatar small" src="{{ s[10] or url_for('static', filename='images/default_avatar.png') }}" alt="Profile" />
              <strong>{{ s[9] }}</strong> â€” <a href="{{ s[3] }}">File</a> ({{ s[4] }})
              <form method="POST" action="{{ url_for('grade_submission', submission_id=s[0]) }}" style="margin-top:0.3em;">
                <input type="text" name="grade" placeholder="Grade" value="{{ s[6] or '' }}" style="width:70px;" />
                <input type="text" name="feedback" placeholder="Feedback" value="{{ s[7] or '' }}" style="width:220px;" />
                <button class="btn" type="submit" style="margin-left:0.6em;">Save</button>
              </form>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No submissions yet.</p>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}